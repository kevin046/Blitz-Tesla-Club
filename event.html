<section class="events-container">
    <div class="event-card featured-event">
        <div class="event-header">
            <img src="https://i.ibb.co/wZccW7CQ/1011165571a04d4f8b1852fd1d061a5b.jpg" 
                 alt="Light show staging area" 
                 class="event-image">
            <div class="event-details">
                <h2>Tesla Light Show Spectacular</h2>
                <div class="event-meta">
                    <p><i class="fas fa-calendar-day"></i> May 30, 2025 @ 8:00 PM</p>
                    <p><i class="fas fa-map-marker-alt"></i> Golf IT Up Parking Lot</p>
                    <p>2910 Steeles Ave East, Thornhill, ON</p>
                </div>
                <div class="event-description">
                    <p>Join us for an unforgettable evening of synchronized Tesla light shows! 
                    Showcase your vehicle's light features and enjoy:</p>
                    <ul>
                        <li>Group light choreography</li>
                        <li>Best-in-show competitions</li>
                        <li>Exclusive merch giveaways</li>
                        <li>Networking with Tesla enthusiasts</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="event-map">
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2876.21620035702!2d-79.47620368434426!3d43.87225594411095!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x882b2a126c606a0d%3A0x5a1b12a3d5b3e8b!2s2910%20Steeles%20Ave%20E%2C%20Thornhill%2C%20ON%20L3T%204A1%2C%20Canada!5e0!3m2!1sen!2sus!4v1718753284509!5m2!1sen!2sus" 
                    width="100%" 
                    height="300" 
                    style="border:0;" 
                    allowfullscreen="" 
                    loading="lazy" 
                    referrerpolicy="no-referrer-when-downgrade">
            </iframe>
        </div>

        <div class="event-actions">
            <button class="btn primary-btn" id="eventRegisterBtn">
                <i class="fas fa-car"></i> Register Your Tesla
            </button>
            <div class="registration-count">
                <i class="fas fa-users"></i> <span id="participantCount">0</span> Teslas Registered
            </div>
        </div>
    </div>
</section>

<style>
/* Event Card Styling */
.event-card {
    background: #1a1a1a;
    border-radius: 12px;
    padding: 25px;
    margin: 2rem 0;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.event-header {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin-bottom: 1.5rem;
}

.event-image {
    width: 100%;
    height: 300px;
    border-radius: 8px;
    object-fit: cover;
}

.event-details h2 {
    color: #00e676;
    margin-bottom: 1rem;
}

.event-meta p {
    margin: 0.8rem 0;
    color: #ccc;
}

.event-description {
    margin-top: 1.5rem;
    padding: 1rem;
    background: #2a2a2a;
    border-radius: 8px;
}

.event-description ul {
    padding-left: 1.5rem;
    margin: 1rem 0;
}

.event-description li {
    margin: 0.5rem 0;
    color: #ddd;
}

.event-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #333;
}

.registration-count {
    background: #2a2a2a;
    padding: 0.8rem 1.2rem;
    border-radius: 25px;
    font-weight: 500;
}

#participantCount {
    color: #00e676;
    font-weight: bold;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', async () => {
    const registrationBtn = document.getElementById('eventRegisterBtn');
    const participantCount = document.getElementById('participantCount');
    
    // Check current registrations
    const { count } = await supabaseClient
        .from('event_registrations')
        .select('*', { count: 'exact' })
        .eq('event_id', 'lightshow-2025');
    
    participantCount.textContent = count || 0;

    // Registration handler
    registrationBtn.addEventListener('click', async () => {
        const { data: { user } } = await supabaseClient.auth.getUser();
        
        if(!user) {
            alert('Please login to register for events');
            return;
        }

        const { error } = await supabaseClient
            .from('event_registrations')
            .upsert({
                user_id: user.id,
                event_id: 'lightshow-2025',
                registration_date: new Date().toISOString()
            });

        if(!error) {
            participantCount.textContent = parseInt(participantCount.textContent) + 1;
            alert('Successfully registered!');
        }
    });
});
</script> 