<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Verification Email Sent - Blitz Tesla Club</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="https://i.postimg.cc/BvmtNLtB/logo.png">
</head>
<body class="verification-page">
    <!-- Standard Navigation -->
    <nav>
        <div class="logo">
            <a href="index.html">
                <img src="https://i.ibb.co/fkrdXZK/Logo4-white.png" alt="Blitz Tesla Club Logo" loading="lazy" width="50" height="50">
                <span>BLITZ T CLUB</span>
            </a>
        </div>
        <div class="menu-toggle">
            <i class="fas fa-bars"></i>
        </div>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="events.html">Events</a></li>
            <li><a href="gallery.html">Gallery</a></li>
            <li><a href="executive.html">Executives</a></li>
            <li><a href="news.html">News</a></li>
            <li><a href="register.html">Join Us</a></li>
            <li><a href="login.html">Login</a></li>
        </ul>
    </nav>

    <main class="verification-container">
        <div class="verification-box">
            <img src="https://i.postimg.cc/BvmtNLtB/logo.png" alt="Blitz Tesla Club Logo" class="verification-logo">
            <h1>Verification Email Sent</h1>
            <p>We've sent a verification email to your inbox. Please check your email and click the verification link to activate your account.</p>
            <p class="user-email" id="userEmail"></p>
            <div class="email-note">
                <p><strong>Important Note:</strong></p>
                <p>You will receive two emails:</p>
                <ol>
                    <li>First email: Click to activate FormSubmit (our email service)</li>
                    <li>Second email: Contains your verification link to activate your account</li>
                </ol>
                <p>Please complete both steps to activate your account.</p>
            </div>
            <div class="verification-info">
                <p><i class="fas fa-laptop"></i> Please confirm verification on the same device you registered from.</p>
                <p><i class="fas fa-info-circle"></i> If you don't see the email, please check your spam folder.</p>
                <p><i class="fas fa-clock"></i> The verification link will expire in 24 hours.</p>
                <p class="device-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Important: Opening the verification link on a different device may cause verification to fail.</span>
                </p>
            </div>
            <div class="verification-actions">
                <a href="login.html" class="btn primary-btn">Return to Login</a>
                <button id="resendButton" class="btn secondary-btn">
                    <i class="fas fa-redo"></i> Resend Email
                </button>
                <p class="timer" id="resendTimer"></p>
            </div>
        </div>
    </main>

    <!-- Standard Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Quick Links</h3>
                <div class="footer-links">
                    <a href="index.html">Home</a>
                    <a href="events.html">Events</a>
                    <a href="gallery.html">Gallery</a>
                    <a href="contact.html">Contact</a>
                </div>
            </div>
            
            <div class="footer-section">
                <h3>Member Area</h3>
                <div class="footer-links">
                    <a href="login.html">Login</a>
                    <a href="register.html">Register</a>
                    <a href="sponsors.html">Our Sponsors</a>
                    <a href="#member-benefits">Member Benefits</a>
                </div>
            </div>
            
            <div class="footer-section">
                <h3>Legal</h3>
                <div class="footer-links">
                    <a href="privacy.html">Privacy Policy</a>
                    <a href="terms.html">Terms of Service</a>
                    <a href="about.html">About Us</a>
                </div>
            </div>

            <div class="footer-section">
                <h3>Connect With Us</h3>
                <div class="footer-social">
                    <a href="https://x.com/BlitzTClub" target="_blank" aria-label="Follow us on X">
                        <i class="fa-brands fa-square-x-twitter"></i>
                    </a>
                    <a href="https://www.instagram.com/blitztclub/" target="_blank" aria-label="Follow us on Instagram">
                        <i class="fab fa-instagram"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <p>Â© 2024 Blitz T Club. All rights reserved.</p>
            <p class="powered-by">
                Website powered by <a href="http://www.summitpixels.com" target="_blank">SummitPixels</a>
            </p>
        </div>
    </footer>

    <style>
        body.verification-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .verification-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            margin: 60px 0;
        }

        .verification-box {
            background: rgba(0, 0, 0, 0.7);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .verification-box h1 {
            margin: 20px 0;
            font-size: 24px;
            color: #fff;
        }

        .verification-box p {
            color: #ccc;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .verification-logo {
            width: 100px;
            margin-bottom: 20px;
        }

        .verification-info {
            margin: 30px 0;
            text-align: left;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
        }

        .verification-info p {
            margin: 10px 0;
            color: #ccc;
            display: flex;
            align-items: center;
        }

        .verification-info i {
            margin-right: 10px;
            color: #4CAF50;
            min-width: 20px;
        }

        .verification-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .verification-actions .btn {
            min-width: 150px;
            padding: 12px 24px;
        }

        .secondary-btn {
            background: transparent;
            border: 2px solid #4CAF50;
            color: #4CAF50;
            transition: all 0.3s ease;
        }

        .secondary-btn:hover {
            background: #4CAF50;
            color: white;
        }

        .email-note {
            background: rgba(76, 175, 80, 0.1);
            border-left: 4px solid #4CAF50;
            padding: 15px 20px;
            margin: 20px 0;
            text-align: left;
            border-radius: 0 10px 10px 0;
        }

        .email-note p {
            margin: 10px 0;
        }

        .email-note strong {
            color: #4CAF50;
        }

        .email-note ol {
            margin: 10px 0;
            padding-left: 25px;
            color: #ccc;
        }

        .email-note li {
            margin: 8px 0;
            line-height: 1.4;
        }

        .device-warning {
            margin-top: 20px !important;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .device-warning i {
            color: #ffc107; /* Warning yellow color */
        }

        .device-warning span {
            color: #ffc107;
            font-weight: 500;
        }

        .user-email {
            color: #4CAF50 !important;
            font-weight: 500;
            font-size: 1.1em;
            margin: 10px 0;
        }

        .timer {
            color: #ccc;
            font-size: 0.9em;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .verification-box {
                margin: 20px;
                padding: 20px;
            }

            .verification-actions {
                flex-direction: column;
                gap: 10px;
            }

            .verification-actions .btn {
                width: 100%;
            }

            .email-note {
                margin: 15px 0;
                padding: 12px 15px;
            }
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Display user's email
            const userEmail = localStorage.getItem('pendingVerificationEmail');
            if (userEmail) {
                document.getElementById('userEmail').textContent = userEmail;
            }

            // Handle resend button click
            const resendButton = document.getElementById('resendButton');
            resendButton.addEventListener('click', async () => {
                try {
                    // Generate verification token
                    const verificationToken = crypto.randomUUID();
                    console.log('Generated token:', verificationToken);

                    // Store token temporarily in localStorage
                    localStorage.setItem('verificationToken', verificationToken);
                    localStorage.setItem('tokenExpiry', new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString());

                    // Get base URL for verification link
                    const baseUrl = window.location.protocol === 'file:' 
                        ? '.' // Use relative path for file:// protocol
                        : window.location.hostname === 'localhost' 
                            ? 'http://localhost:3000' 
                            : 'https://www.blitztclub.com';
                    const verificationUrl = `${baseUrl}/${baseUrl === '.' ? '' : ''}verify-email.html?token=${verificationToken}`;

                    // Send verification email using FormSubmit
                    const formData = new FormData();
                    formData.append('email', userEmail);
                    formData.append('_captcha', 'false');
                    formData.append('_template', 'box');
                    formData.append('_subject', 'Verify Your Blitz T Club Membership');
                    formData.append('_autoresponse', 'Thank you for verifying your email. Your Blitz T Club membership will be activated shortly.');
                    formData.append('message', `Welcome to Blitz T Club!

Member ID: ${localStorage.getItem('pendingMemberId')}

Please click the link below to verify your email and activate your membership:
${verificationUrl}

Important Notes:
- This verification link will expire in 24 hours
- Please verify on the same device you're currently using
- After verification, your membership will be activated instantly

Next Steps:
1. Click the verification link above
2. Your membership will be activated instantly
3. Access your digital membership card
4. Start enjoying member benefits

If you can't click the link, copy and paste this URL into your browser:
${verificationUrl}

If you didn't request this email, please ignore it.

Best regards,
Blitz T Club Team`);

                    // Send the verification email
                    const emailResponse = await fetch(`https://formsubmit.co/ajax/${userEmail}`, {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/json'
                        },
                        body: formData
                    });

                    if (!emailResponse.ok) {
                        const responseText = await emailResponse.text();
                        console.error('FormSubmit response:', responseText);
                        throw new Error('Failed to send verification email');
                    }

                    // Update button state
                    resendButton.disabled = true;
                    resendButton.innerHTML = '<i class="fas fa-check"></i> Email Sent';
                    
                    // Start countdown timer
                    let timeLeft = 60;
                    const timerElement = document.getElementById('resendTimer');
                    const timer = setInterval(() => {
                        timeLeft--;
                        timerElement.textContent = `Resend available in ${timeLeft}s`;
                        if (timeLeft <= 0) {
                            clearInterval(timer);
                            resendButton.disabled = false;
                            resendButton.innerHTML = '<i class="fas fa-redo"></i> Resend Email';
                            timerElement.textContent = '';
                        }
                    }, 1000);

                } catch (error) {
                    console.error('Error sending verification:', error);
                    alert('Failed to send verification email. Please try again.');
                }
            });
        });
    </script>
</body>
</html> 